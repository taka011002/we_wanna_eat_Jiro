{"ast":null,"code":"var _jsxFileName = \"/Users/yuzi/myprograming/next-todo/pages/rooms.tsx\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useState, useEffect } from \"react\";\nimport Peer from \"skyway-js\";\nimport { SKYWAY_API_KEY } from \"./env\";\n\nconst Rooms = props => {\n  const getRoomModeByHash = () => location.hash === \"#sfu\" ? \"sfu\" : \"mesh\";\n\n  const {\n    0: roomMode,\n    1: setRoomMode\n  } = useState(getRoomModeByHash());\n  const {\n    0: localVideoMuted,\n    1: setLocalVideoMuted\n  } = useState(true);\n  const {\n    0: localVideoStream,\n    1: setLocalVideoStream\n  } = useState(new MediaStream());\n  const {\n    0: localVideoPlaysInline,\n    1: setLocalVideoPlaysInline\n  } = useState(true);\n  const peer = new Peer({\n    key: SKYWAY_API_KEY\n  });\n\n  const joinHandler = async () => {\n    // Note that you need to ensure the peer has connected to signaling server\n    // before using methods of peer instance.\n    if (!peer.open) {\n      return;\n    }\n\n    const room = peer.joinRoom(roomId.value, {\n      mode: getRoomModeByHash(),\n      stream: await navigator.mediaDevices.getUserMedia({\n        audio: true,\n        video: true\n      })\n    });\n    room.once(\"open\", () => {\n      messages.textContent += \"=== You joined ===\\n\";\n    });\n    room.on(\"peerJoin\", peerId => {\n      messages.textContent += `=== ${peerId} joined ===\\n`;\n    }); // Render remote stream for new peer join in the room\n\n    room.on(\"stream\", async stream => {\n      const newVideo = document.createElement(\"video\");\n      newVideo.srcObject = stream;\n      newVideo.playsInline = true; // mark peerId to find it later at peerLeave event\n\n      newVideo.setAttribute(\"data-peer-id\", stream.peerId);\n      remoteVideos.append(newVideo);\n      await newVideo.play().catch(console.error);\n    });\n    room.on(\"data\", ({\n      data,\n      src\n    }) => {\n      // Show a message sent to the room and who sent\n      messages.textContent += `${src}: ${data}\\n`;\n    }); // for closing room members\n\n    room.on(\"peerLeave\", peerId => {\n      const remoteVideo = remoteVideos.querySelector(`[data-peer-id=${peerId}]`);\n      remoteVideo.srcObject.getTracks().forEach(track => track.stop());\n      remoteVideo.srcObject = null;\n      remoteVideo.remove();\n      messages.textContent += `=== ${peerId} left ===\\n`;\n    }); // for closing myself\n\n    room.once(\"close\", () => {\n      sendTrigger.removeEventListener(\"click\", onClickSend);\n      messages.textContent += \"== You left ===\\n\";\n      Array.from(remoteVideos.children).forEach(remoteVideo => {\n        remoteVideo.srcObject.getTracks().forEach(track => track.stop());\n        remoteVideo.srcObject = null;\n        remoteVideo.remove();\n      });\n    });\n    sendTrigger.addEventListener(\"click\", onClickSend);\n    leaveTrigger.addEventListener(\"click\", () => room.close(), {\n      once: true\n    });\n\n    function onClickSend() {\n      // Send message to all of the peers in the room via websocket\n      room.send(localText.value);\n      messages.textContent += `${peer.id}: ${localText.value}\\n`;\n      localText.value = \"\";\n    }\n  };\n\n  useEffect(() => {\n    window.addEventListener(\"hashchange\", () => setRoomMode(getRoomModeByHash()));\n  }, []);\n  return __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    className: \"container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 7\n    }\n  }, __jsx(\"h1\", {\n    className: \"heading\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 9\n    }\n  }, \"Room Example \\u30BF\\u30A4\\u30C8\\u30EB\"), __jsx(\"div\", {\n    className: \"room\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 11\n    }\n  }, __jsx(\"video\", {\n    id: \"local-stream\",\n    muted: localVideoMuted,\n    ref: async video => {\n      // Cannot set property 'srcObject' of null問題\n      video.srcObject = await navigator.mediaDevices.getUserMedia({\n        audio: true,\n        video: true\n      });\n      await video.play();\n    },\n    playsInline: localVideoPlaysInline,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 13\n    }\n  }), __jsx(\"span\", {\n    id: \"room-mode\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 13\n    }\n  }, roomMode), __jsx(\"input\", {\n    type: \"text\",\n    placeholder: \"Room Name\",\n    id: \"js-room-id\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 13\n    }\n  }), __jsx(\"button\", {\n    id: \"join-trigger\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 13\n    }\n  }, \"Join\"), __jsx(\"button\", {\n    id: \"leave-trigger\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 13\n    }\n  }, \"Leave\")), __jsx(\"div\", {\n    className: \"remote-streams\",\n    id: \"js-remote-streams\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 11\n    }\n  }), __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 11\n    }\n  }, __jsx(\"pre\", {\n    className: \"messages\",\n    id: \"messages\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 13\n    }\n  }), __jsx(\"input\", {\n    type: \"text\",\n    id: \"local-text\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 13\n    }\n  }), __jsx(\"button\", {\n    id: \"send-trigger\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 13\n    }\n  }, \"Send\")))), __jsx(\"ul\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 7\n    }\n  }));\n};\n\nRooms.getInitialProps = async ({\n  query\n}) => {\n  return 1;\n};\n\nexport default Rooms;","map":{"version":3,"sources":["/Users/yuzi/myprograming/next-todo/pages/rooms.tsx"],"names":["useState","useEffect","Peer","SKYWAY_API_KEY","Rooms","props","getRoomModeByHash","location","hash","roomMode","setRoomMode","localVideoMuted","setLocalVideoMuted","localVideoStream","setLocalVideoStream","MediaStream","localVideoPlaysInline","setLocalVideoPlaysInline","peer","key","joinHandler","open","room","joinRoom","roomId","value","mode","stream","navigator","mediaDevices","getUserMedia","audio","video","once","messages","textContent","on","peerId","newVideo","document","createElement","srcObject","playsInline","setAttribute","remoteVideos","append","play","catch","console","error","data","src","remoteVideo","querySelector","getTracks","forEach","track","stop","remove","sendTrigger","removeEventListener","onClickSend","Array","from","children","addEventListener","leaveTrigger","close","send","localText","id","window","getInitialProps","query"],"mappings":";;;AAAA,SAASA,QAAT,EAAmBC,SAAnB,QAAoC,OAApC;AACA,OAAOC,IAAP,MAAiB,WAAjB;AAEA,SAAmBC,cAAnB,QAAyC,OAAzC;;AAEA,MAAMC,KAAK,GAAIC,KAAD,IAAW;AACvB,QAAMC,iBAAiB,GAAG,MAAOC,QAAQ,CAACC,IAAT,KAAkB,MAAlB,GAA2B,KAA3B,GAAmC,MAApE;;AAEA,QAAM;AAAA,OAACC,QAAD;AAAA,OAAWC;AAAX,MAA0BV,QAAQ,CAACM,iBAAiB,EAAlB,CAAxC;AACA,QAAM;AAAA,OAACK,eAAD;AAAA,OAAkBC;AAAlB,MAAwCZ,QAAQ,CAAC,IAAD,CAAtD;AACA,QAAM;AAAA,OAACa,gBAAD;AAAA,OAAmBC;AAAnB,MAA0Cd,QAAQ,CAAC,IAAIe,WAAJ,EAAD,CAAxD;AACA,QAAM;AAAA,OAACC,qBAAD;AAAA,OAAwBC;AAAxB,MAAoDjB,QAAQ,CAAC,IAAD,CAAlE;AACA,QAAMkB,IAAI,GAAG,IAAIhB,IAAJ,CAAS;AAAEiB,IAAAA,GAAG,EAAEhB;AAAP,GAAT,CAAb;;AACA,QAAMiB,WAAW,GAAG,YAAY;AAC9B;AACA;AACA,QAAI,CAACF,IAAI,CAACG,IAAV,EAAgB;AACd;AACD;;AAED,UAAMC,IAAI,GAAGJ,IAAI,CAACK,QAAL,CAAcC,MAAM,CAACC,KAArB,EAA4B;AACvCC,MAAAA,IAAI,EAAEpB,iBAAiB,EADgB;AAEvCqB,MAAAA,MAAM,EAAE,MAAMC,SAAS,CAACC,YAAV,CAAuBC,YAAvB,CAAoC;AAChDC,QAAAA,KAAK,EAAE,IADyC;AAEhDC,QAAAA,KAAK,EAAE;AAFyC,OAApC;AAFyB,KAA5B,CAAb;AAQAV,IAAAA,IAAI,CAACW,IAAL,CAAU,MAAV,EAAkB,MAAM;AACtBC,MAAAA,QAAQ,CAACC,WAAT,IAAwB,sBAAxB;AACD,KAFD;AAGAb,IAAAA,IAAI,CAACc,EAAL,CAAQ,UAAR,EAAqBC,MAAD,IAAY;AAC9BH,MAAAA,QAAQ,CAACC,WAAT,IAAyB,OAAME,MAAO,eAAtC;AACD,KAFD,EAlB8B,CAsB9B;;AACAf,IAAAA,IAAI,CAACc,EAAL,CAAQ,QAAR,EAAkB,MAAOT,MAAP,IAAkB;AAClC,YAAMW,QAAQ,GAAGC,QAAQ,CAACC,aAAT,CAAuB,OAAvB,CAAjB;AACAF,MAAAA,QAAQ,CAACG,SAAT,GAAqBd,MAArB;AACAW,MAAAA,QAAQ,CAACI,WAAT,GAAuB,IAAvB,CAHkC,CAIlC;;AACAJ,MAAAA,QAAQ,CAACK,YAAT,CAAsB,cAAtB,EAAsChB,MAAM,CAACU,MAA7C;AACAO,MAAAA,YAAY,CAACC,MAAb,CAAoBP,QAApB;AACA,YAAMA,QAAQ,CAACQ,IAAT,GAAgBC,KAAhB,CAAsBC,OAAO,CAACC,KAA9B,CAAN;AACD,KARD;AAUA3B,IAAAA,IAAI,CAACc,EAAL,CAAQ,MAAR,EAAgB,CAAC;AAAEc,MAAAA,IAAF;AAAQC,MAAAA;AAAR,KAAD,KAAmB;AACjC;AACAjB,MAAAA,QAAQ,CAACC,WAAT,IAAyB,GAAEgB,GAAI,KAAID,IAAK,IAAxC;AACD,KAHD,EAjC8B,CAsC9B;;AACA5B,IAAAA,IAAI,CAACc,EAAL,CAAQ,WAAR,EAAsBC,MAAD,IAAY;AAC/B,YAAMe,WAAW,GAAGR,YAAY,CAACS,aAAb,CACjB,iBAAgBhB,MAAO,GADN,CAApB;AAGAe,MAAAA,WAAW,CAACX,SAAZ,CAAsBa,SAAtB,GAAkCC,OAAlC,CAA2CC,KAAD,IAAWA,KAAK,CAACC,IAAN,EAArD;AACAL,MAAAA,WAAW,CAACX,SAAZ,GAAwB,IAAxB;AACAW,MAAAA,WAAW,CAACM,MAAZ;AAEAxB,MAAAA,QAAQ,CAACC,WAAT,IAAyB,OAAME,MAAO,aAAtC;AACD,KATD,EAvC8B,CAkD9B;;AACAf,IAAAA,IAAI,CAACW,IAAL,CAAU,OAAV,EAAmB,MAAM;AACvB0B,MAAAA,WAAW,CAACC,mBAAZ,CAAgC,OAAhC,EAAyCC,WAAzC;AACA3B,MAAAA,QAAQ,CAACC,WAAT,IAAwB,mBAAxB;AACA2B,MAAAA,KAAK,CAACC,IAAN,CAAWnB,YAAY,CAACoB,QAAxB,EAAkCT,OAAlC,CAA2CH,WAAD,IAAiB;AACzDA,QAAAA,WAAW,CAACX,SAAZ,CAAsBa,SAAtB,GAAkCC,OAAlC,CAA2CC,KAAD,IAAWA,KAAK,CAACC,IAAN,EAArD;AACAL,QAAAA,WAAW,CAACX,SAAZ,GAAwB,IAAxB;AACAW,QAAAA,WAAW,CAACM,MAAZ;AACD,OAJD;AAKD,KARD;AAUAC,IAAAA,WAAW,CAACM,gBAAZ,CAA6B,OAA7B,EAAsCJ,WAAtC;AACAK,IAAAA,YAAY,CAACD,gBAAb,CAA8B,OAA9B,EAAuC,MAAM3C,IAAI,CAAC6C,KAAL,EAA7C,EAA2D;AAAElC,MAAAA,IAAI,EAAE;AAAR,KAA3D;;AAEA,aAAS4B,WAAT,GAAuB;AACrB;AACAvC,MAAAA,IAAI,CAAC8C,IAAL,CAAUC,SAAS,CAAC5C,KAApB;AAEAS,MAAAA,QAAQ,CAACC,WAAT,IAAyB,GAAEjB,IAAI,CAACoD,EAAG,KAAID,SAAS,CAAC5C,KAAM,IAAvD;AACA4C,MAAAA,SAAS,CAAC5C,KAAV,GAAkB,EAAlB;AACD;AACF,GAvED;;AAyEAxB,EAAAA,SAAS,CAAC,MAAM;AACdsE,IAAAA,MAAM,CAACN,gBAAP,CAAwB,YAAxB,EAAsC,MACpCvD,WAAW,CAACJ,iBAAiB,EAAlB,CADb;AAGD,GAJQ,EAIN,EAJM,CAAT;AAMA,SACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAK,IAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAI,IAAA,SAAS,EAAC,SAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6CADF,EAEE;AAAK,IAAA,SAAS,EAAC,MAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AACE,IAAA,EAAE,EAAC,cADL;AAEE,IAAA,KAAK,EAAEK,eAFT;AAGE,IAAA,GAAG,EAAE,MAAOqB,KAAP,IAAiB;AACpB;AACAA,MAAAA,KAAK,CAACS,SAAN,GAAkB,MAAMb,SAAS,CAACC,YAAV,CAAuBC,YAAvB,CAAoC;AAC1DC,QAAAA,KAAK,EAAE,IADmD;AAE1DC,QAAAA,KAAK,EAAE;AAFmD,OAApC,CAAxB;AAIA,YAAMA,KAAK,CAACc,IAAN,EAAN;AACD,KAVH;AAWE,IAAA,WAAW,EAAE9B,qBAXf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAcE;AAAM,IAAA,EAAE,EAAC,WAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAsBP,QAAtB,CAdF,EAeE;AAAO,IAAA,IAAI,EAAC,MAAZ;AAAmB,IAAA,WAAW,EAAC,WAA/B;AAA2C,IAAA,EAAE,EAAC,YAA9C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAfF,EAgBE;AAAQ,IAAA,EAAE,EAAC,cAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAhBF,EAiBE;AAAQ,IAAA,EAAE,EAAC,eAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAjBF,CADF,EAoBE;AAAK,IAAA,SAAS,EAAC,gBAAf;AAAgC,IAAA,EAAE,EAAC,mBAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IApBF,EAqBE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAK,IAAA,SAAS,EAAC,UAAf;AAA0B,IAAA,EAAE,EAAC,UAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAEE;AAAO,IAAA,IAAI,EAAC,MAAZ;AAAmB,IAAA,EAAE,EAAC,YAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFF,EAGE;AAAQ,IAAA,EAAE,EAAC,cAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAHF,CArBF,CAFF,CADF,EA+BE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IA/BF,CADF;AAmCD,CA1HD;;AA4HAL,KAAK,CAACoE,eAAN,GAAwB,OAAO;AAAEC,EAAAA;AAAF,CAAP,KAAqB;AAC3C,SAAO,CAAP;AACD,CAFD;;AAIA,eAAerE,KAAf","sourcesContent":["import { useState, useEffect } from \"react\";\nimport Peer from \"skyway-js\";\n\nimport { API_PATH, SKYWAY_API_KEY } from \"./env\";\n\nconst Rooms = (props) => {\n  const getRoomModeByHash = () => (location.hash === \"#sfu\" ? \"sfu\" : \"mesh\");\n\n  const [roomMode, setRoomMode] = useState(getRoomModeByHash());\n  const [localVideoMuted, setLocalVideoMuted] = useState(true);\n  const [localVideoStream, setLocalVideoStream] = useState(new MediaStream());\n  const [localVideoPlaysInline, setLocalVideoPlaysInline] = useState(true);\n  const peer = new Peer({ key: SKYWAY_API_KEY });\n  const joinHandler = async () => {\n    // Note that you need to ensure the peer has connected to signaling server\n    // before using methods of peer instance.\n    if (!peer.open) {\n      return;\n    }\n\n    const room = peer.joinRoom(roomId.value, {\n      mode: getRoomModeByHash(),\n      stream: await navigator.mediaDevices.getUserMedia({\n        audio: true,\n        video: true,\n      }),\n    });\n\n    room.once(\"open\", () => {\n      messages.textContent += \"=== You joined ===\\n\";\n    });\n    room.on(\"peerJoin\", (peerId) => {\n      messages.textContent += `=== ${peerId} joined ===\\n`;\n    });\n\n    // Render remote stream for new peer join in the room\n    room.on(\"stream\", async (stream) => {\n      const newVideo = document.createElement(\"video\");\n      newVideo.srcObject = stream;\n      newVideo.playsInline = true;\n      // mark peerId to find it later at peerLeave event\n      newVideo.setAttribute(\"data-peer-id\", stream.peerId);\n      remoteVideos.append(newVideo);\n      await newVideo.play().catch(console.error);\n    });\n\n    room.on(\"data\", ({ data, src }) => {\n      // Show a message sent to the room and who sent\n      messages.textContent += `${src}: ${data}\\n`;\n    });\n\n    // for closing room members\n    room.on(\"peerLeave\", (peerId) => {\n      const remoteVideo = remoteVideos.querySelector(\n        `[data-peer-id=${peerId}]`\n      );\n      remoteVideo.srcObject.getTracks().forEach((track) => track.stop());\n      remoteVideo.srcObject = null;\n      remoteVideo.remove();\n\n      messages.textContent += `=== ${peerId} left ===\\n`;\n    });\n\n    // for closing myself\n    room.once(\"close\", () => {\n      sendTrigger.removeEventListener(\"click\", onClickSend);\n      messages.textContent += \"== You left ===\\n\";\n      Array.from(remoteVideos.children).forEach((remoteVideo) => {\n        remoteVideo.srcObject.getTracks().forEach((track) => track.stop());\n        remoteVideo.srcObject = null;\n        remoteVideo.remove();\n      });\n    });\n\n    sendTrigger.addEventListener(\"click\", onClickSend);\n    leaveTrigger.addEventListener(\"click\", () => room.close(), { once: true });\n\n    function onClickSend() {\n      // Send message to all of the peers in the room via websocket\n      room.send(localText.value);\n\n      messages.textContent += `${peer.id}: ${localText.value}\\n`;\n      localText.value = \"\";\n    }\n  };\n\n  useEffect(() => {\n    window.addEventListener(\"hashchange\", () =>\n      setRoomMode(getRoomModeByHash())\n    );\n  }, []);\n\n  return (\n    <div>\n      <div className=\"container\">\n        <h1 className=\"heading\">Room Example タイトル</h1>\n        <div className=\"room\">\n          <div>\n            <video\n              id=\"local-stream\"\n              muted={localVideoMuted}\n              ref={async (video) => {\n                // Cannot set property 'srcObject' of null問題\n                video.srcObject = await navigator.mediaDevices.getUserMedia({\n                  audio: true,\n                  video: true,\n                });\n                await video.play();\n              }}\n              playsInline={localVideoPlaysInline}\n            ></video>\n            <span id=\"room-mode\">{roomMode}</span>\n            <input type=\"text\" placeholder=\"Room Name\" id=\"js-room-id\" />\n            <button id=\"join-trigger\">Join</button>\n            <button id=\"leave-trigger\">Leave</button>\n          </div>\n          <div className=\"remote-streams\" id=\"js-remote-streams\"></div>\n          <div>\n            <pre className=\"messages\" id=\"messages\"></pre>\n            <input type=\"text\" id=\"local-text\" />\n            <button id=\"send-trigger\">Send</button>\n          </div>\n        </div>\n      </div>\n      <ul></ul>\n    </div>\n  );\n};\n\nRooms.getInitialProps = async ({ query }) => {\n  return 1;\n};\n\nexport default Rooms;\n"]},"metadata":{},"sourceType":"module"}